# Story 1.2: Detekce výhry a remízy

## Story ID
1.2

## Title
Detekce výhry a remízy

## Epic
1

## Status
Completed

## Description
Implementace logiky pro:
- Detekci výhry (5 polí v řadě - horizontálně, vertikálně, diagonálně)
- Detekci remízy (plná mřížka bez výhry)
- Blokování dalších tahů po výhře/remíze
- Zobrazení výsledku (Vítěz: X/O, Remíza)
- Zvýraznění výherní kombinace (5-tice polí)

## Functional Requirements Covered
- FR4: Detekce výhry v řádku/sloupci/diagonále - výhra je 5 polí v řadě
- FR5: Detekce remízy, když plná mřížka bez výhry
- FR6: Tlačítko „Nová hra" resetuje stav (rozšíření z 1.1)

## Acceptance Criteria

- AC2.1: Po 5 polích v řadě (stejný symbol) se hra zastopí
- AC2.2: Výherní kombinace se zvýrazní (např. background color)
- AC2.3: Zobrazí se modal/banner "Vítěz: X" nebo "Vítěz: O"
- AC2.4: Po výhře je zablokován další klik (AC1 z 1.1)
- AC2.5: Detekce remízy - když všechna pole obsazena bez výhry
- AC2.6: Zobrazí se "Remíza" zpráva
- AC2.7: Po remíze je zablokován další klik
- AC2.8: "Nová hra" resetuje stav a hraje X

## File List

### New Files
- `src/win-detector.js` - Logika detekce výhry (algoritmy pro řádky/sloupce/diagonály)

### Modified Files
- `src/game.js` - Integrace win-detector, game over state, zobrazení výsledku
- `src/index.html` - Modal/banner pro výsledek
- `src/styles.css` - Stylování zvýraznění výhry, modalu

### Test Files
- `src/win-detector.test.js` - Unit testy detekce výhry (20+ testů)
- `src/game.integration.test.js` - Update s testy výhry/remízy (10+ nových testů)

## Test Plan

### Unit Tests (src/win-detector.test.js)
- Test: Detekce výhry horizontálně (5 X v řadě)
- Test: Detekce výhry vertikálně (5 O v řadě)
- Test: Detekce výhry diagonálně dolů (5 X v řadě ↘)
- Test: Detekce výhry diagonálně nahoru (5 O v řadě ↖)
- Test: Detekce výhry v rohu (0,0)
- Test: Detekce výhry ve středu
- Test: Detekce výhry na okraji
- Test: Bez výhry (4 v řadě)
- Test: Bez výhry (volné místo v řadě)
- Test: Detekce remízy (plná mřížka bez výhry)
- Test: Není remíza (plná řada ale ne všechna pole)

### Integration Tests (src/game.integration.test.js)
- Test: Po výhře je gameOver = true
- Test: Po výhře jsou kliknutí zablokována
- Test: Výherní pole jsou zvýrazněna v DOM
- Test: Zobrazí se modal s výsledkem
- Test: Reset po výhře resetuje game over flag
- Test: Detekce remízy v integration
- Test: Modal se skryje po reset

### Manual Testing
- [ ] Vyhraju horizontálně (5 X v řadě) → zvýraznění + modal
- [ ] Vyhraju vertikálně (5 O v řadě) → zvýraznění + modal
- [ ] Vyhraju diagonálně ↘ → zvýraznění + modal
- [ ] Vyhraju diagonálně ↖ → zvýraznění + modal
- [ ] Hraju remízu (mřížka plná) → "Remíza" modal
- [ ] Po výhře kliknu - nic se nestane (zablokováno)
- [ ] Kliknu "Nová hra" → resetuje se vše
- [ ] Test všech variantů na mobilu

## Risk Assessment

**Risk 1:** Performance - algoritmus detekce výhry může být pomalý
- Mitigation: Optimalizace - kontrola jen od posledního tahu

**Risk 2:** Edge cases - výhra na okrajích/rozích
- Mitigation: Thorough unit tests pro všechny pozice

**Risk 3:** Vizuální feedback - uživatel nevidí vítěze
- Mitigation: Clear modal + zvýraznění polí

## Technical Notes

### Win Detection Algorithm
```
Pro každý nový tah (x, y):
  Kontrola 4 směrů (horizontal, vertical, diagonal-1, diagonal-2)
  Pro každý směr:
    Počítej obsazená pole v oba směry od (x, y)
    Pokud počet >= 5, vítězství nalezeno
  Vrať vítězství + souřadnice výherní kombinace
```

### Performance Optimization
- Kontrola jen z posledního tahu (ne celá mřížka)
- Bitwise operations pro rychlé porovnání
- Cache výsledků

### UI Implementation
- Modal nebo banner na top/center
- Zvýraznění pomocí CSS class `.winning-cell`
- Disable všech cell clicků po gameOver

## Definition of Done

- [x] Kód napsaný a testovaný (win-detector.js)
- [x] Integrace do game.js
- [x] Unit testy projdou (30/30)
- [x] Integration testy projdou (18/18)
- [x] UI zobrazuje výsledek správně (modal + zvýraznění)
- [x] Responsivní na mobilu
- [x] Manual testing completed
- [x] Code review completed

## Implementation Summary

### Test Results
```
✓ src/win-detector.test.js (30 tests) 13ms
✓ src/game.test.js (20 tests) 17ms
✓ src/game.integration.test.js (18 tests) 152ms

Test Files  3 passed (3)
     Tests  68 passed (68)
```

### Acceptance Criteria - Status
- ✓ AC2.1: Detekce výhry (5 v řadě) - zastavuje hru
- ✓ AC2.2: Výherní kombinace se zvýrazní CSS class `.winning-cell` s animací
- ✓ AC2.3: Modal zobrazuje "Vítěz: X" nebo "Vítěz: O"
- ✓ AC2.4: Po výhře jsou tahy zablokované (gameOver flag)
- ✓ AC2.5: Detekce remízy (plná mřížka bez výhry)
- ✓ AC2.6: Zobrazení "Remíza" zprávy v modalu
- ✓ AC2.7: Po remíze jsou tahy zablokované
- ✓ AC2.8: Tlačítko "Nová hra" resetuje vše a hraje X

### Architecture Implemented
- **checkWin()**: Detekce výhry v 4 směrech (horizontální, vertikální, diagonál ↘, diagonál ↗)
- **checkDraw()**: Detekce remízy (všechna pole obsazená)
- **checkGameState()**: Kombinovaná kontrola výhry/remízy
- **Win Detection Algorithm**: Kontrola jen od posledního tahu (optimizace)
- **UI Modal**: Zobrazení výsledku s možností zavření
- **CSS Animations**: Pulzující efekt na výherních polích

### How to Run
```bash
npm test     # Všechny 68 testů
npm run dev  # Dev server na http://localhost:5173
```

## Comments

Story 1.2 je kompletní! MVP má nyní plnou herní logiku s detekcí výhry, remízy a uživatelským feedbackem.

## Next Steps
Následující story 1.3 by měla zahrnovat:
- Reset hry a UI vylepšení
- Score tracking (volitelné)
- Možné vylepšení pro feature stories
