# Story 1.2: Detekce výhry a remízy

## Story ID
1.2

## Title
Detekce výhry a remízy

## Epic
1

## Status
Draft

## Description
Implementace logiky pro:
- Detekci výhry (5 polí v řadě - horizontálně, vertikálně, diagonálně)
- Detekci remízy (plná mřížka bez výhry)
- Blokování dalších tahů po výhře/remíze
- Zobrazení výsledku (Vítěz: X/O, Remíza)
- Zvýraznění výherní kombinace (5-tice polí)

## Functional Requirements Covered
- FR4: Detekce výhry v řádku/sloupci/diagonále - výhra je 5 polí v řadě
- FR5: Detekce remízy, když plná mřížka bez výhry
- FR6: Tlačítko „Nová hra" resetuje stav (rozšíření z 1.1)

## Acceptance Criteria

- AC2.1: Po 5 polích v řadě (stejný symbol) se hra zastopí
- AC2.2: Výherní kombinace se zvýrazní (např. background color)
- AC2.3: Zobrazí se modal/banner "Vítěz: X" nebo "Vítěz: O"
- AC2.4: Po výhře je zablokován další klik (AC1 z 1.1)
- AC2.5: Detekce remízy - když všechna pole obsazena bez výhry
- AC2.6: Zobrazí se "Remíza" zpráva
- AC2.7: Po remíze je zablokován další klik
- AC2.8: "Nová hra" resetuje stav a hraje X

## File List

### New Files
- `src/win-detector.js` - Logika detekce výhry (algoritmy pro řádky/sloupce/diagonály)

### Modified Files
- `src/game.js` - Integrace win-detector, game over state, zobrazení výsledku
- `src/index.html` - Modal/banner pro výsledek
- `src/styles.css` - Stylování zvýraznění výhry, modalu

### Test Files
- `src/win-detector.test.js` - Unit testy detekce výhry (20+ testů)
- `src/game.integration.test.js` - Update s testy výhry/remízy (10+ nových testů)

## Test Plan

### Unit Tests (src/win-detector.test.js)
- Test: Detekce výhry horizontálně (5 X v řadě)
- Test: Detekce výhry vertikálně (5 O v řadě)
- Test: Detekce výhry diagonálně dolů (5 X v řadě ↘)
- Test: Detekce výhry diagonálně nahoru (5 O v řadě ↖)
- Test: Detekce výhry v rohu (0,0)
- Test: Detekce výhry ve středu
- Test: Detekce výhry na okraji
- Test: Bez výhry (4 v řadě)
- Test: Bez výhry (volné místo v řadě)
- Test: Detekce remízy (plná mřížka bez výhry)
- Test: Není remíza (plná řada ale ne všechna pole)

### Integration Tests (src/game.integration.test.js)
- Test: Po výhře je gameOver = true
- Test: Po výhře jsou kliknutí zablokována
- Test: Výherní pole jsou zvýrazněna v DOM
- Test: Zobrazí se modal s výsledkem
- Test: Reset po výhře resetuje game over flag
- Test: Detekce remízy v integration
- Test: Modal se skryje po reset

### Manual Testing
- [ ] Vyhraju horizontálně (5 X v řadě) → zvýraznění + modal
- [ ] Vyhraju vertikálně (5 O v řadě) → zvýraznění + modal
- [ ] Vyhraju diagonálně ↘ → zvýraznění + modal
- [ ] Vyhraju diagonálně ↖ → zvýraznění + modal
- [ ] Hraju remízu (mřížka plná) → "Remíza" modal
- [ ] Po výhře kliknu - nic se nestane (zablokováno)
- [ ] Kliknu "Nová hra" → resetuje se vše
- [ ] Test všech variantů na mobilu

## Risk Assessment

**Risk 1:** Performance - algoritmus detekce výhry může být pomalý
- Mitigation: Optimalizace - kontrola jen od posledního tahu

**Risk 2:** Edge cases - výhra na okrajích/rozích
- Mitigation: Thorough unit tests pro všechny pozice

**Risk 3:** Vizuální feedback - uživatel nevidí vítěze
- Mitigation: Clear modal + zvýraznění polí

## Technical Notes

### Win Detection Algorithm
```
Pro každý nový tah (x, y):
  Kontrola 4 směrů (horizontal, vertical, diagonal-1, diagonal-2)
  Pro každý směr:
    Počítej obsazená pole v oba směry od (x, y)
    Pokud počet >= 5, vítězství nalezeno
  Vrať vítězství + souřadnice výherní kombinace
```

### Performance Optimization
- Kontrola jen z posledního tahu (ne celá mřížka)
- Bitwise operations pro rychlé porovnání
- Cache výsledků

### UI Implementation
- Modal nebo banner na top/center
- Zvýraznění pomocí CSS class `.winning-cell`
- Disable všech cell clicků po gameOver

## Definition of Done

- [ ] Kód napsaný a testovaný (win-detector.js)
- [ ] Integrace do game.js
- [ ] Unit testy projdou (20+)
- [ ] Integration testy projdou (10+)
- [ ] UI zobrazuje výsledek správně
- [ ] Responsivní na mobilu
- [ ] Manual testing completed
- [ ] Code review pending

## Comments

Kritické pro MVP - bez toho hra nemá cíl!
Zvýraznění výhry je UX improvement, ne povinné.
