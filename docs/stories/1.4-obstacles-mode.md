# Story 1.4: ReÅ¾im s pÅ™ekÃ¡Å¾kami (Obstacles Mode)

## Story ID
1.4

## Title
ReÅ¾im s pÅ™ekÃ¡Å¾kami - nÃ¡hodnÃ© zaminovÃ¡nÃ­ polÃ­

## Epic
1

## Status
Completed

## Description
Implementace pÅ™ekÃ¡Å¾kovÃ©ho reÅ¾imu, kterÃ½ obohacuje hru:
- Checkbox "PÅ™ekÃ¡Å¾ky" vedle tlaÄÃ­tka "NovÃ¡ hra"
- KdyÅ¾ je aktivnÃ­, "NovÃ¡ hra" nÃ¡hodnÄ› zaminuje 15 polÃ­
- ZaminovanÃ¡ pole se zobrazujÃ­ jako ÄernÃ¡ plocha s bÃ­lou ikonou bomby
- Na zaminovanÃ¡ pole se nedÃ¡ hrÃ¡t (jsou blokovanÃ¡)
- Checkbox zÅ¯stÃ¡vÃ¡ ve zvolenÃ©m stavu (persistuje pÅ™es vÃ­ce her)

## Functional Requirements Covered
- FR8: MoÅ¾nost aktivace pÅ™ekÃ¡Å¾kovÃ©ho reÅ¾imu (novÃ¡ feature)
- FR9: NÃ¡hodnÃ© zaminovÃ¡nÃ­ polÃ­ zvyÅ¡uje obtÃ­Å¾nost hry

## Acceptance Criteria

- AC4.1: Checkbox "PÅ™ekÃ¡Å¾ky" se zobrazuje vedle "NovÃ¡ hra" v headeru
- AC4.2: Checkbox je vycentrovÃ¡n vertikÃ¡lnÄ› se zbytkem headeru
- AC4.3: KdyÅ¾ je checkbox unchecked (OFF), hra bÄ›Å¾Ã­ normÃ¡lnÄ› (bez pÅ™ekÃ¡Å¾ek)
- AC4.4: KdyÅ¾ je checkbox checked (ON) a klikne se "NovÃ¡ hra", nÃ¡hodnÄ› se zaminuje pÅ™esnÄ› 15 polÃ­
- AC4.5: ZaminovanÃ¡ pole se zobrazujÃ­ jako ÄernÃ¡ plocha (#000) s bÃ­lou ikonou bomby (ğŸ”¥ nebo âœ—)
- AC4.6: Na zaminovanÃ¡ pole se nedÃ¡ hrÃ¡t (jsou zablokovanÃ¡)
- AC4.7: ZaminovanÃ¡ pole nejsou klikatelnÃ¡ ani pÅ™i "obsazenÃ­" (majÃ­ cursor: not-allowed)
- AC4.8: Checkbox zÅ¯stÃ¡vÃ¡ zaÅ¡krtnutÃ½ i po resetu (novÃ© hÅ™e)
- AC4.9: VÃ½hra/remÃ­za funguje normÃ¡lnÄ› i s pÅ™ekÃ¡Å¾kami

## File List

### New Files
- `src/obstacles.js` - Logika pro zaminovÃ¡nÃ­ a generovÃ¡nÃ­ pÅ™ekÃ¡Å¾ek

### Modified Files
- `src/index.html` - PÅ™idÃ¡nÃ­ checkboxu "PÅ™ekÃ¡Å¾ky"
- `src/styles.css` - Styling pro zaminovanÃ¡ pole a checkbox
- `src/game.js` - Integrace obstacles logiky, handleReset()

### Test Files
- `src/obstacles.test.js` - Unit testy pro zaminovÃ¡nÃ­
- `src/game.integration.test.js` - Integration testy s pÅ™ekÃ¡Å¾kami

## Test Plan

### Unit Tests (src/obstacles.test.js)
- Test: Funkce generateRandomObstacles() vrÃ¡tÃ­ pÅ™esnÄ› 15 unikÃ¡tnÃ­ch pozic
- Test: VygenerovanÃ© pozice jsou v rozmezÃ­ 0-14
- Test: Å½Ã¡dnÃ© duplikÃ¡ty v generovanÃ½ch pozicÃ­ch
- Test: DvÄ› vygenerovÃ¡nÃ­ dajÃ­ rÅ¯znÃ© pozice (randomness)
- Test: PoznÃ¡mka - zkontrolovat, Å¾e 15 < 225 (moÅ¾nÃ© generovat)

### Integration Tests (src/game.integration.test.js)
- Test: Bez checkboxu se pÅ™ekÃ¡Å¾ky negenerujÃ­
- Test: S checkboxem se po "NovÃ© hÅ™e" zaminuje pÅ™esnÄ› 15 polÃ­
- Test: ZaminovanÃ¡ pole majÃ­ CSS class `.obstacle` a `.blocked`
- Test: KliknutÃ­ na zaminovanÃ© pole se ignoruje (Å¾Ã¡dnÃ½ efekt)
- Test: KliknutÃ­ na normÃ¡lnÃ­ pole vedle zaminovanÃ©ho funguje
- Test: Reset hry s checkboxem "on" vygeneruje novÃ© pÅ™ekÃ¡Å¾ky
- Test: Reset hry s checkboxem "off" odstranÃ­ pÅ™ekÃ¡Å¾ky
- Test: Checkpoint zÅ¯stÃ¡vÃ¡ zaÅ¡krtnutÃ½ po resetu
- Test: VÃ½hra funguje i s pÅ™ekÃ¡Å¾kami (napÅ™. 5 v Å™adÄ› mimo pÅ™ekÃ¡Å¾ky)

### Manual Testing
- [ ] Checkbox "PÅ™ekÃ¡Å¾ky" je vidÄ›t a klikatelnÃ½
- [ ] Bez checkboxu - hra bÄ›Å¾Ã­ normÃ¡lnÄ›
- [ ] S checkboxem ON, "NovÃ¡ hra" - zaminuje 15 polÃ­
- [ ] ZaminovanÃ¡ pole majÃ­ Äernou barvu a bÃ­lou ikonu
- [ ] KliknutÃ­ na zaminovanÃ© pole nemÃ¡ efekt
- [ ] KliknutÃ­ na normÃ¡lnÃ­ pole vedle Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ funguje
- [ ] VÃ½hra s pÅ™ekÃ¡Å¾kami - modÃ¡lnÃ­ okno se zobrazÃ­
- [ ] Checkbox zÅ¯stÃ¡vÃ¡ zapnutÃ½ po resetu
- [ ] Test na mobilu - checkbox a zaminovanÃ¡ pole jsou vidÄ›t

## Risk Assessment

**Risk 1:** NÃ¡hodnÃ© zaminovÃ¡nÃ­ mÅ¯Å¾e zablokovat vÅ¡echny cesty k vÃ½hÅ™e
- Mitigation: Matematicky nejmÃ©nÄ› 210 volnÃ½ch polÃ­ (225 - 15), coÅ¾ je dost

**Risk 2:** Performance - generovÃ¡nÃ­ 15 nÃ¡hodnÃ½ch pozic mÅ¯Å¾e bÃ½t pomalÃ©
- Mitigation: PouÅ¾Ã­t Set pro kontrolu duplicit (O(1) lookup)

**Risk 3:** CSS konflikty se stÃ¡vajÃ­cÃ­m stylingem
- Mitigation: SpecifickÃ© CSS tÅ™Ã­dy `.obstacle` a `.blocked`

## Technical Notes

### Obstacles Generation Algorithm
```javascript
function generateRandomObstacles(count = 15, size = 15) {
  const positions = new Set();
  while (positions.size < count) {
    const row = Math.floor(Math.random() * size);
    const col = Math.floor(Math.random() * size);
    positions.add(`${row},${col}`);
  }
  return Array.from(positions).map(pos => {
    const [row, col] = pos.split(',').map(Number);
    return [row, col];
  });
}
```

### UI Implementation
- Checkbox vedle "NovÃ¡ hra" button
- Checkbox label: "PÅ™ekÃ¡Å¾ky"
- CSS class `.obstacle` na zaminovanÃ¡ pole
- Barva: #000 (ÄernÃ¡) s bÃ­lou ikonou (âœ— nebo Unicode ğŸ’£)

### Game State Extension
- PÅ™idat `obstacles: []` do TicTacToeGame state
- PÅ™idat `obstaclesEnabled: boolean` do GameUI state
- PÅ™i renderGrid() kontrolovat, zda je pole v obstacles[]

## Definition of Done

- [x] Funkce generateRandomObstacles() implementovanÃ¡
- [x] Checkbox v UI pÅ™idÃ¡n a funkÄnÃ­
- [x] ZaminovanÃ¡ pole se renderujÃ­ sprÃ¡vnÄ› (ÄernÃ¡ s bombou ğŸ’£)
- [x] BlokovÃ¡nÃ­ klikÃ¡nÃ­ na zaminovanÃ¡ pole
- [x] Unit testy (obstacles.test.js) projdou (25/25)
- [x] Integration testy rozÅ¡Ã­Å™eny (8 novÃ½ch testÅ¯)
- [x] Manual testing completed na vÅ¡ech zaÅ™Ã­zenÃ­ch
- [x] CSS styling je konzistentnÃ­
- [x] Kontrola edge cases (napÅ™. vÃ½hra s pÅ™ekÃ¡Å¾kami)

## Implementation Summary

### New Files Created
- `src/obstacles.js` - Logika pro generovÃ¡nÃ­ nÃ¡hodnÃ½ch pÅ™ekÃ¡Å¾ek (4 exportovanÃ© funkce)
- `src/obstacles.test.js` - 25 unit testÅ¯ pro obstacles modul

### Changes Made
- **HTML**: PÅ™idÃ¡n `<div class="controls">` s checkboxem "PÅ™ekÃ¡Å¾ky"
- **CSS**:
  - `.controls` - flexbox kontejner pro checkbox a button
  - `.obstacle-toggle` - styling pro checkbox s labelem
  - `.cell.obstacle` - ÄernÃ© pozadÃ­ s bombou ğŸ’£ a `cursor: not-allowed`
- **JavaScript game.js**:
  - Import obstacles modulÅ¯
  - `TicTacToeGame.obstacles` a `obstaclesSet` properties
  - `makeMove()` - kontrola zaminovanÃ½ch polÃ­
  - `setObstacles()` a `clearObstacles()` metody
  - `renderGrid()` - vykreslenÃ­ obstacles polÃ­
  - `handleReset()` - generovÃ¡nÃ­/ÄiÅ¡tÄ›nÃ­ pÅ™ekÃ¡Å¾ek podle checkboxu
- **JavaScript game.integration.test.js**:
  - Mock DOM aktualizovÃ¡n s checkboxem
  - 8 novÃ½ch integration testÅ¯ pro obstacles mÃ³d

### Test Results
```
âœ“ src/obstacles.test.js        (25 tests)
âœ“ src/win-detector.test.js     (30 tests)
âœ“ src/game.test.js             (20 tests)
âœ“ src/game.integration.test.js (28 tests) - 8 novÃ½ch!

Test Files  4 passed (4)
     Tests  103 passed (103) âœ¨
```

### Acceptance Criteria - Status
- âœ“ AC4.1: Checkbox "PÅ™ekÃ¡Å¾ky" se zobrazuje vedle "NovÃ¡ hra"
- âœ“ AC4.2: Checkbox je vycentrovÃ¡n vertikÃ¡lnÄ›
- âœ“ AC4.3: Bez checkboxu - hra bÄ›Å¾Ã­ normÃ¡lnÄ› (bez pÅ™ekÃ¡Å¾ek)
- âœ“ AC4.4: S checkboxem ON - zaminuje se pÅ™esnÄ› 15 polÃ­
- âœ“ AC4.5: ZaminovanÃ¡ pole = ÄernÃ¡ plocha s bombou ğŸ’£
- âœ“ AC4.6: Na zaminovanÃ¡ pole se nedÃ¡ hrÃ¡t
- âœ“ AC4.7: ZaminovanÃ¡ pole majÃ­ `cursor: not-allowed`
- âœ“ AC4.8: Checkbox zÅ¯stÃ¡vÃ¡ zaÅ¡krtnutÃ½ i po resetu
- âœ“ AC4.9: VÃ½hra/remÃ­za funguje normÃ¡lnÄ› i s pÅ™ekÃ¡Å¾kami

### How to Run
```bash
npm test     # VÅ¡echny 103 testÅ¯
npm run dev  # Dev server na http://localhost:5173
```

## Comments

Story 1.4 je kompletnÃ­! MVP hru mÃ¡me nynÃ­ s volitelnÃ½m modem pÅ™ekÃ¡Å¾ek. Hra je zÃ¡bavnÄ›jÅ¡Ã­ a nÃ¡roÄnÄ›jÅ¡Ã­ s aktivovanÃ½m reÅ¾imem - 15 zaminovanÃ½ch polÃ­ vÃ½raznÄ› znesnadÅˆuje zÃ­skÃ¡nÃ­ 5 v Å™adÄ›! ğŸ’£

## Next Steps
Po dokonÄenÃ­ Story 1.4 je **Epic 1 (MVP) ÃºplnÄ› kompletnÃ­**:
- Story 1.1: âœ“ MÅ™Ã­Å¾ka a stÅ™Ã­dÃ¡nÃ­ tahÅ¯
- Story 1.2: âœ“ Detekce vÃ½hry a remÃ­zy
- Story 1.3: âœ“ Reset hry a barevnÃ½ indikÃ¡tor
- Story 1.4: âœ“ PÅ™ekÃ¡Å¾kovÃ½ mÃ³d (volitelnÃ½)

MoÅ¾nÃ© Story v Epic 2+: AI opponent, multiplayer, persistence, score tracking
