# Story 2.1: GitHub Pages Setup & Build Configuration

## Story ID
2.1

## Title
GitHub Pages Setup - Automatizovaný Build & Deploy Pipeline

## Epic
2

## Status
In Progress - Configuration Complete

## Description
Nastavení GitHub Pages a GitHub Actions workflow pro automatický build a deploy Piškvorek aplikace.

Po splnění této story:
- GitHub Pages bude aktivní v repozitáři
- GitHub Actions workflow automaticky builduje a deployuje na push
- Hra bude dostupná na `https://[username].github.io/piskvorky`
- Build selže, pokud selhávají testy

## Functional Requirements Covered
- FR1: Projekt je dostupný na veřejné URL
- FR2: Automatický deploy na main branch
- FR3: Build validation (testy musí projít)

## Acceptance Criteria

- AC2.1: GitHub Pages je nastaveny v Settings → Pages → Source = GitHub Actions
- AC2.1.1: Branch = main (nebo master)
- AC2.1.2: Build & Deployment je nastaven
- AC2.2: GitHub Actions workflow soubor existuje: `.github/workflows/deploy.yml`
- AC2.2.1: Workflow se spustí na push do main
- AC2.2.2: Workflow spustí `npm install` a `npm test`
- AC2.2.3: Workflow failuje, pokud testy selhají (exit code != 0)
- AC2.2.4: Workflow builduje projekt: `npm run build`
- AC2.2.5: Build artifacts se uploadují do GitHub Pages
- AC2.3: Hra je dostupná na veřejné URL
- AC2.3.1: URL funguje: `https://[username].github.io/piskvorky`
- AC2.3.2: Aplikace je plně funkční (všechny features fungují)
- AC2.4: Vite config je správně nastaven pro GitHub Pages
- AC2.4.1: `base` je nastaveno na `/piskvorky/` (nebo `/` pokud custom domain)
- AC2.4.2: Assets jsou správně servovány (relativní cesty)
- AC2.5: Build process je deterministický (vícenásobné buildy jsou identické)
- AC2.6: Responzivní design funguje na GitHub Pages URL
- AC2.6.1: Hra je hratelná na mobilu (Chrome DevTools 375px)
- AC2.6.2: Hra je hratelná na tabletu (768px)
- AC2.6.3: Hra je hratelná na desktopu (1440px)

## File List

### New Files
- `.github/workflows/deploy.yml` - GitHub Actions workflow

### Modified Files
- `vite.config.js` - Přidání `base` pro GitHub Pages
- `package.json` - Přidání deploy skriptu (pokud třeba)

### Documentation Files
- `docs/stories/2.1-github-pages-setup.md` - Tato story

## Test Plan

### Manual Testing
- [ ] Pushu do main branch
- [ ] Kontroluji GitHub Actions tab v repozitáři
- [ ] Workflow se spustí automaticky
- [ ] Workflow nejdříve spustí `npm test`
- [ ] Pokud testy projdou, workflow builduje
- [ ] Build artifacts jsou v deployment artefaktu
- [ ] Otevřu veřejnou URL
- [ ] Hra se načte správně
- [ ] Všechny features fungují
- [ ] Testuji na mobilu (DevTools)
- [ ] Testuji na tabletu (DevTools)
- [ ] Assets se načítají správně (F12 → Network)

### GitHub Actions Validation
- [ ] Workflow se zobrazuje v Actions tabu
- [ ] Successfull run (zelená zatržítka)
- [ ] Deployment artefakt existuje
- [ ] Pages deployment je successful

## Risk Assessment

**Risk 1:** Build timeout na GitHub Actions (free tier má limity)
- Mitigation: Vite je rychlý, `npm test` by neměl trvat dlouho
- Monitoring: Sledovat časy v Actions tabu

**Risk 2:** Asset paths jsou špatně (game nenačte se)
- Mitigation: Správně nastavit `base` v vite.config.js
- Testing: Kontrolovat Network tab (F12)

**Risk 3:** Responsive design se rozbije na GitHub Pages
- Mitigation: Testovat lokálně `npm run build && npm run preview`
- Testing: DevTools mobile simulation

## Technical Notes

### GitHub Pages Configuration

```yaml
# V Settings → Pages:
- Source: GitHub Actions
- Branch: main
- Custom domain: (prázdné pro teď)
```

### Vite Config Update

```javascript
// vite.config.js
export default {
  base: '/piskvorky/',  // Důležité pro GitHub Pages!
  // ... rest of config
}
```

### GitHub Actions Workflow

```yaml
# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npm test

      - name: Build
        run: npm run build

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

## Implementation Summary

### Completed Steps:
1. ✓ Created `.github/workflows/deploy.yml` with GitHub Actions workflow
   - Triggers on push to main/master branches
   - Runs npm install, npm test, npm run build in sequence
   - Deploys build artifacts to GitHub Pages using peaceiris/actions-gh-pages
   - Fails if tests don't pass (build validation)

2. ✓ Updated `vite.config.js` with GitHub Pages base path
   - Added: `base: '/piskvorky/'`
   - Assets are now correctly referenced with repository path prefix

3. ✓ Verified all tests pass (103/103 ✓)
   - win-detector.test.js: 30 tests
   - obstacles.test.js: 25 tests
   - game.test.js: 20 tests
   - game.integration.test.js: 28 tests

4. ✓ Verified production build works (141ms)
   - Generated dist/ directory with optimized assets
   - CSS: 4.65 kB (gzip: 1.41 kB)
   - JavaScript: 7.35 kB (gzip: 2.54 kB)
   - HTML: 1.53 kB (gzip: 0.67 kB)

### Remaining Steps:
- Manual testing: Push to main branch and verify GitHub Pages deployment
- Verify GitHub Pages Settings are configured correctly
- Test responsive design on deployed URL
- Verify all features work on live GitHub Pages URL

## Definition of Done

- [x] `.github/workflows/deploy.yml` vytvořen a funkční
- [x] `vite.config.js` aktualizován s `base: '/piskvorky/'`
- [ ] GitHub Pages je aktivní a automaticky deployuje
- [ ] Hra je dostupná na veřejné URL
- [ ] Build failuje, pokud selhávají testy
- [ ] Responsivní design funguje na GitHub Pages
- [x] Všechny testy procházejí (103/103)
- [ ] Hra je plně hratelná na veřejné URL

## Comments

Kritické pro vystavení projektu. Jakmile je hotová, může si projekt zahrát kdokoliv na internetu!

## Next Steps
Po Story 2.1:
- Story 2.2: Dokumentace & Testing Setup (README, deployment guide)
- Hra bude live na GitHub Pages
- Možný custom domain (pokud vlastníš)
